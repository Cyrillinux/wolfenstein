var App=App||{};App.maps=App.maps||{},App.Properties={container:"stage",selectorEngine:function(){return{byId:function(e){return document.getElementById(e)},createTag:function(e){return document.createElement(e)},getByTag:function(e){return document.getElementsByTagName(e)[0]},removeById:function(e){var t=document.getElementById(e),i=t.parentNode;i.removeChild(t)}}}(),templateEngine:App.template,texturesPath:"src/resources/textures/",spritesPath:"src/resources/sprites/",statusbarPath:"src/resources/statusbar/",soundPath:"src/resources/sounds/",fps:30,playerSpeed:.2,playerRotateSpeed:3,raycastingColor:"rgba(0,100,0,0.3)",screenWidth:720,screenHeight:480,stripWidth:2,miniMapElementId:"minimap",miniMapObjectElementId:"minimapobjects",miniMapScale:4,miniMapBlocksColor:"#000",miniMapDebugMode:!1},App.Helpful={isNull:function(e){return void 0===e||null===e},isNumber:function(e){return"number"==typeof e},hasOnlyNumbers:function(e){for(var t=!0,i=0;i<e.length;i++)if(!App.Helpful.isNumber(e[i])){t=!1;break}return t},isArray:function(e){return e instanceof Array},mergeObjects:function(e,t){for(var i in e)e[i]&&e[i].constructor&&e[i].constructor===Object?(t[i]=t[i]||{},arguments.callee(e[i],t[i])):t[i]=e[i];return t},isNodeWebkit:function(){return"object"==typeof process}},App.define=App.define||function(e,t,i){function s(e){var t={},s=e[0];e.reverse();for(var n=0;e.length>n;n++){var r={};if(0===n){var o={};switch(s){case"views":o=i(function(){},App.Properties.selectorEngine,App.Properties.templateEngine);break;default:o=i(function(){})}r[e[n]]=o}else r[e[n]]=t;t=r}return t}function n(e,t){return App.Helpful.mergeObjects(e,t)}var r=t.split("/");r.push(e);var o=s(r);App=n(o,App)},App.define("Shortcut","core/config",function(e){"use strict";function t(){var e=0,t=i.length;for(e;t>e;e++){var s=i[e];App[s.key]=s.value}}var i=[{key:"container",value:App.Properties.container}];return e=function(){t()},e.prototype.addShortcut=function(e,t){App[e]=t},e}),new App.core.config.Shortcut,App.Exception={"throw":function(e,t){var i="::Exception::";App.Helpful.isNull(e)||App.Helpful.isNull(t)?console.error(i+"\n	 Message: "+e):console.error(i+"\n	 Message: "+e+"\n	 Cause: ",t)}},App.define("Collision","engine",function(e){"use strict";function t(e,t,i,s){if(0>t||t>=i.mapHeight||0>e||e>=i.mapWidth)return!0;var n=Math.floor(e),r=Math.floor(t);return 0!==i.level.map[r][n]?!0:s.sprites.spriteMap[r][n]&&s.sprites.spriteMap[r][n].block?!0:!1}return e.prototype.checkCollision=function(e,i,s,n,r,o,a){var p={x:e,y:i};if(0>n||n>=o.mapHeight||0>s||s>=o.mapWidth)return p;var l=Math.floor(s),h=Math.floor(n);if(t(l,h,o,a))return p;p.x=s,p.y=n;var c=t(l,h-1,o,a),u=t(l,h+1,o,a),d=t(l-1,h,o,a),y=t(l+1,h,o,a);c&&r>n-h&&(n=p.y=h+r),u&&r>h+1-n&&(n=p.y=h+1-r),d&&r>s-l&&(s=p.x=l+r),y&&r>l+1-s&&(s=p.x=l+1-r);var f=0,g=0;return 0===t(l-1,h-1,o,a)||0!==c&&0!==d||(f=s-l,g=n-h,r*r>f*f+g*g&&(f*f>g*g?s=p.x=l+r:n=p.y=h+r)),0===t(l+1,h-1,o,a)||0!==c&&0!==y||(f=s-(l+1),g=n-h,r*r>f*f+g*g&&(f*f>g*g?s=p.x=l+1-r:n=p.y=h+r)),0===t(l-1,h+1,o,a)||0!==u&&0!==u||(f=s-l,g=n-(h+1),r*r>f*f+g*g&&(f*f>g*g?s=p.x=l+r:n=p.y=h+1-r)),0===t(l+1,h+1,o,a)||0!==u&&0!==y||(f=s-(l+1),g=n-(h+1),r*r>f*f+g*g&&(f*f>g*g?s=p.x=l+1-r:n=p.y=h+1-r)),p},e}),App.define("Controls","engine",function(e){"use strict";var t=!1,i=!1;return e=function(){console.log("[Controls] Configured"),this.forwardKey=[38,87],this.backwardKey=[40,83],this.rightKey=[39,68],this.leftKey=[37,65],this.enableMap=77,this.enableFPSDisplay=70,this.shoot=[0,32]},e.prototype.keyboardMap=function(e){var s,n=this,r=App.Properties.selectorEngine,o=r.byId("minimap-container"),a=r.byId("fps-debug");try{s=new Event("shoot")}catch(p){s=document.createEvent("CustomEvent"),s.initCustomEvent("shoot",!1,!1,null)}document.onkeydown=function(r){switch(r=r||window.event,r.keyCode){case n.forwardKey[0]:case n.forwardKey[1]:e.speed=1;break;case n.backwardKey[0]:case n.backwardKey[1]:e.speed=-1;break;case n.leftKey[0]:case n.leftKey[1]:e.dir=-1;break;case n.rightKey[0]:case n.rightKey[1]:e.dir=1;break;case n.enableMap:t?(t=!1,o.style.display="none"):(t=!0,o.style.display="block");break;case n.enableFPSDisplay:i?(i=!1,a.style.display="none"):(i=!0,a.style.display="block");break;case n.shoot[0]:case n.shoot[1]:document.dispatchEvent(s)}},document.onkeyup=function(t){switch(t=t||window.event,t.keyCode){case n.forwardKey[0]:case n.forwardKey[1]:case n.backwardKey[0]:case n.backwardKey[1]:e.speed=0;break;case n.leftKey[0]:case n.leftKey[1]:case n.rightKey[0]:case n.rightKey[1]:e.dir=0}}},e}),App.define("Enemies","engine",function(e){"use strict";var t="guard";return e=function(e){console.log("[Enemies] Add enemies"),this.$selector=e,this.enemiesList=[],this.entity=new App.engine.Entity},e.prototype.init=function(e){this.enemiesAmount=e.length;var i=0,s=this.$selector.byId("screen");for(i;this.enemiesAmount>i;i++){var n=e[i];if(n.type===t){var r=new App.engine.enemies.Guard(n,this.$selector);this.enemiesList.push(r),s.appendChild(r.img)}}},e.prototype.render=function(e,t,i){var s=0;for(s;s<this.enemiesAmount;s++){var n=this.enemiesList[s],r=n.img,o=n.x-e.x,a=n.y-e.y,p=Math.atan2(a,o)-e.rot;p<-Math.PI&&(p+=2*Math.PI),p>=Math.PI&&(p-=2*Math.PI);var l=0,h=0,c=0,u=Math.tan(p)*t,d=null,y=null,f=null,g=null,v=null,m=0,M="none",b=null;if(p>.5*-Math.PI&&p<.5*Math.PI){if(l=o*o+a*a,h=Math.sqrt(l),c=t/(Math.cos(p)*h),0>=c)continue;u=Math.tan(p)*t,d=r.style,y=n.oldStyles,c!==y.height&&(d.height=c+"px",y.height=c),f=c*n.totalStates,f!==y.width&&(d.width=f+"px",y.width=f),g=(i.screenHeight-c)/2,g!=y.top&&(d.top=g+"px",y.top=g),v=i.screenWidth/2+u-c/2-c*n.state,v!==y.left&&(d.left=v+"px",y.left=v),m=-(1e3*l)>>0,m!==y.zIndex&&(d.zIndex=m,y.zIndex=m),M="block",M!==y.display&&(d.display=M,y.display=M),b="rect(0px, "+c*(n.state+1)+"px, "+c+"px, "+c*n.state+"px)",b!==y.clip&&(d.clip=b,y.clip=b)}else M="none",M!==n.oldStyles.display&&(r.style.display=M,n.oldStyles.display=M)}},e.prototype.ai=function(e,t,i,s,n){var r=0;for(r;r<this.enemiesAmount;r++){var o=this.enemiesList[r],a=t.x-o.x,p=t.y-o.y,l=Math.sqrt(a*a+p*p);if(l>4){var h=Math.atan2(p,a);o.rotDeg=180*h/Math.PI,o.rot=h,o.speed=1,o.state=Math.floor(new Date%o.walkCycleTime/(o.walkCycleTime/o.numWalkSprites))+1}else o.state=0,o.speed=0;this.entity.move(o,e,i,s,n)}},e}),App.define("Entity","engine",function(e){"use strict";return e=function(){this.collision=new App.engine.Collision},e.prototype.move=function(e,t,i,s,n){var r=t/n,o=r*e.speed*e.moveSpeed;e.rotDeg+=r*e.dir*e.rotSpeed,e.rotDeg%=360,e.rotDeg<-180&&(e.rotDeg+=360),e.rotDeg>=180&&(e.rotDeg-=360);var a=(e.rotDeg+360)%90;(2>a||a>88)&&(e.rotDeg=90*Math.round(e.rotDeg/90)),e.rot=e.rotDeg*Math.PI/180;var p=e.x+Math.cos(e.rot)*o,l=e.y+Math.sin(e.rot)*o,h=this.collision.checkCollision(e.x,e.y,p,l,.35,i,s);e.x=h.x,e.y=h.y},e}),App.define("FaceReaction","engine",function(e){"use strict";function t(e){for(var t=r*o.length,s=0;100>s;s++)i(e,t*s)}function i(e,t){var i=o.length;setTimeout(function(){for(var t=0;i>t;t++)s(e,o[t],r*t)},t)}function s(e,t,i){setTimeout(function(){e.reactions.className=t},i)}function n(e){var t=e.createTag("div");return t.id="reactions",t.className="face01",t}var r=(App.Properties.statusbarPath,500),o=["face01","face02","face03","face02","face01","face01","face01","face02","face02","face03","face03","face01","face03","face01","face02","face03","face02"];return e=function(e){console.log("[FaceReaction] Creating the face reaction"),this.$=e,this.reactions=n(this.$),t(this)},e.prototype.faces=function(){return this.reactions},e}),App.define("FPSDebug","engine",function(e){"use strict";return e=function(){console.log("[FPS debug] Enabled");var e=App.Properties.selectorEngine;this.overlay=e.byId("fps-debug")},e.prototype.update=function(e){this.overlay.innerHTML="FPS: "+e.toFixed(1)+"<br/>"+this.overlayText,this.overlayText=""},e}),App.define("GameCycle","engine",function(e){"use strict";var t=App.Properties.fps,i=1e3/t,s=0,n=0;return e=function(){console.log("[GameCycle] Creating the Game Cycle")},e.prototype.setElements=function(e,t,i,s,n,r,o){this.player=e,this.miniMap=t,this.raycasting=s,this.screen=i,this.statusBar=n,this.fpsDebug=new App.engine.FPSDebug,this.levelSound=r,this.levelSound.play(),this.gameEvents=o},e.prototype.init=function(){var e=(new Date).getTime(),t=e-s;this.player.move(this.miniMap,this.screen,t,i),this.screen.enemies.ai(t,this.player,this.miniMap,this.screen,i),this.statusBar.update();var n=i;t>n&&(n=Math.max(1,n-(t-n)));var r=this;setTimeout(function(){r.init()},n),s=e},e.prototype.renderCycle=function(){this.miniMap.update(this.player),this.screen.sprites.clearObjects(),this.raycasting.castRays(),this.screen.sprites.renderObjects(this.player,this.raycasting.viewDist,this.screen.screenWidth,this.screen.screenHeight),this.screen.enemies.render(this.player,this.raycasting.viewDist,this.screen);var e=(new Date).getTime(),t=e-n,s=i;this.gameEvents.process(this.player,this.raycasting.viewDist,this.screen,this.miniMap,s,t),t>s&&(s=Math.max(1,s-(t-s))),n=e;var r=this;setTimeout(function(){r.renderCycle()},s),this.fpsDebug.update(1e3/t)},e}),App.define("GameEvents","engine",function(e){"use strict";function t(e,t,i,s,n,r,o,a){if(void 0===e)return!1;var p=(i.x===e.x,i.y===e.y,i.rotDeg===e.rotDeg,e.img),l=e.x-i.x,h=e.y-i.y,c=Math.atan2(h,l)-i.rot;c<-Math.PI&&(c+=2*Math.PI),c>=Math.PI&&(c-=2*Math.PI);var u=0,d=0,y=0,f=Math.tan(c)*s,g=null,v=null,m=null,M=null,b=null,S=0,x="none",A=null;if(c>.5*-Math.PI&&c<.5*Math.PI){if(u=l*l+h*h,d=Math.sqrt(u),y=s/(Math.cos(c)*d),0>=y)return!1;f=Math.tan(c)*s,g=p.style,v=e.oldStyles,y!==v.height&&(g.height=y+"px",v.height=y),m=y*e.totalStates,m!==v.width&&(g.width=m+"px",v.width=m),M=(n.screenHeight-y)/2,M!=v.top&&(g.top=M+"px",v.top=M),b=n.screenWidth/2+f-y/2-y*e.state,b!==v.left&&(g.left=b+"px",v.left=b),S=-(1e3*u)>>0,S!==v.zIndex&&(g.zIndex=S,v.zIndex=S),x="block",x!==v.display&&(g.display=x,v.display=x),A="rect(0px, "+y*(e.state+1)+"px, "+y+"px, "+y*e.state+"px)",A!==v.clip&&(g.clip=A,v.clip=A)}else x="none",x!==e.oldStyles.display&&(p.style.display=x,e.oldStyles.display=x);l=i.x-e.x,h=i.y-e.y,d=Math.sqrt(l*l+h*h),c=Math.atan2(h,l),e.state=Math.floor(new Date%e.walkCycleTime/(e.walkCycleTime/e.numWalkSprites))+1;var w=e.x,P=e.y,k=!1;return t.move(e,a,r,n,o),(e.x===w||e.y===P)&&(k=!0),k}function i(){for(var e=8,t=+new Date,i=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},s=t.toString(),n=s.split("").reverse(),r="",o=0;e>o;++o){var a=i(0,n.length-1);r+=n[a]}return r}return e=function(e){console.log("[GameEvents] Preparing to manager all game events"),this.$selector=e,this.playerShoots=[],this.entity=new App.engine.Entity},e.prototype.process=function(e,i,s,n,r,o){if(this.playerShoots.length>0)for(var a=0;this.playerShoots.length>a;a++){var p=this.playerShoots[a],l=t(p,this.entity,e,i,s,n,r,o);l&&(this.$selector.removeById(p.id),delete this.playerShoots[a])}},e.prototype.postEvent=function(e){var t=this.$selector.byId("screen");if("PLAYER_SHOOT"===e.type){var s={id:"shoot-"+i(),positionX:e.x,positionY:e.y,rotDeg:e.rotDeg,gunType:e.gunType,moveSpeed:e.moveSpeed,speed:e.speed},n=new App.engine.Shoot(s,this.$selector);this.playerShoots.push(n),t.appendChild(n.img)}},e}),App.define("MiniMap","engine",function(e){"use strict";function t(e,t){var s=t.byId(n),h=t.byId(r);s.width=a*o,s.height=p*o,h.width=s.width,h.height=s.height;var c=a*o+"px",u=p*o+"px";s.style.width=h.style.width=c,s.style.height=h.style.height=u;for(var d=s.getContext("2d"),y=0;p>y;y++)for(var f=0;a>f;f++){var g=e.map[y][f];g>0&&(d.fillStyle=l,i(d,f,y))}}function i(e,t,i){if(h){var n=25,r=c*n;c++,setTimeout(function(){s(e,t,i)},r)}else s(e,t,i)}function s(e,t,i){e.fillRect(t*o,i*o,o,o)}var n=App.Properties.miniMapElementId,r=App.Properties.miniMapObjectElementId,o=App.Properties.miniMapScale,a=0,p=0,l=App.Properties.miniMapBlocksColor,h=App.Properties.miniMapDebugMode,c=1;return e=function(e,t){console.log("[MiniMap] Creating the mini map"),this.level=e,this.$selector=t},e.prototype.init=function(){a=this.level.map[0].length,p=this.level.map.length,this.mapWidth=a,this.mapHeight=p,this.miniMapScale=o,t(this.level,this.$selector)},e.prototype.update=function(e){var t=this.$selector.byId(n);this.miniMapObjects=this.$selector.byId(r);var i=this.miniMapObjects.getContext("2d");i.clearRect(0,0,t.width,t.height),i.fillRect(e.x*this.miniMapScale-2,e.y*this.miniMapScale-2,4,4),i.beginPath(),i.moveTo(e.x*this.miniMapScale,e.y*this.miniMapScale),i.lineTo((e.x+4*Math.cos(e.rot))*this.miniMapScale,(e.y+4*Math.sin(e.rot))*this.miniMapScale),i.closePath(),i.stroke()},e}),App.define("Player","engine",function(e){"use strict";return e=function(e,t){console.log("[Player] Creating a Player"),this.x=e,this.y=t,this.dir=0,this.rot=0,this.rotDeg=0,this.speed=0,this.moveSpeed=App.Properties.playerSpeed,this.rotSpeed=App.Properties.playerRotateSpeed,this.setControls(),this.entity=new App.engine.Entity,this.shootListener()},e.prototype.move=function(e,t,i,s){this.entity.move(this,i,e,t,s)},e.prototype.setControls=function(){var e=new App.engine.Controls;e.keyboardMap(this)},e.prototype.shootListener=function(){var e=this;document.addEventListener("shoot",function(t){e.shoot(e)},!1)},e.prototype.shoot=function(e){var t={type:"PLAYER_SHOOT",gunType:"pistol",x:e.x,y:e.y,rotDeg:e.rotDeg,moveSpeed:.1,speed:10};document.gameEvents.postEvent(t)},e}),App.define("Raycasting","engine",function(e){"use strict";function t(e,t,n,o,a,p){a=t.rot+a,a%=r,0>a&&(a+=r);for(var l,h,c,u=a>.75*r||.25*r>a,d=0>a||a>Math.PI,y=0,f=Math.sin(a),g=Math.cos(a),v=0,m=0,M=0,b=0,S=0,x=!1,A=!1,w=f/g,P=u?1:-1,k=P*w,C=u?Math.ceil(t.x):Math.floor(t.x),I=t.y+(C-t.x)*w,E=0,T=0;C>=0&&C<n.mapWidth&&I>=0&&I<n.mapHeight;){if(h=Math.floor(C+(u?0:-1)),c=Math.floor(I),e.sprites.spriteMap[c][h]&&!e.sprites.spriteMap[c][h].visible&&(e.sprites.spriteMap[c][h].visible=!0,e.sprites.visibleSprites.push(e.sprites.spriteMap[c][h])),n.level.map[c][h]>0){E=C-t.x,T=I-t.y,v=E*E+T*T,y=n.level.map[c][h],l=I%1,u||(l=1-l),m=C,M=I,b=h,S=c,x=!0,A=!0;break}C+=P,I+=k}w=g/f;var D=d?-1:1,W=D*w;for(I=d?Math.floor(t.y):Math.ceil(t.y),C=t.x+(I-t.y)*w;C>=0&&C<n.mapWidth&&I>=0&&I<n.mapHeight;){if(c=Math.floor(I+(d?-1:0)),h=Math.floor(C),e.sprites.spriteMap[c][h]&&!e.sprites.spriteMap[c][h].visible&&(e.sprites.spriteMap[c][h].visible=!0,e.sprites.visibleSprites.push(e.sprites.spriteMap[c][h])),n.level.map[c][h]>0){E=C-t.x,T=I-t.y;var $=E*E+T*T;(!v||v>$)&&(v=$,m=C,M=I,b=h,S=c,y=n.level.map[c][h],l=C%1,d&&(l=1-l),x=!1);break}C+=W,I+=D}v&&(i(m,M,n,t),s(e,p,v,t,o,a,y,l,n.level,x,b,S))}function i(e,t,i,s){var n=i.miniMapObjects.getContext("2d");n.strokeStyle=App.Properties.raycastingColor,n.lineWidth=.5,n.beginPath(),n.moveTo(s.x*i.miniMapScale,s.y*i.miniMapScale),n.lineTo(e*i.miniMapScale,t*i.miniMapScale),n.closePath(),n.stroke()}function s(e,t,i,s,n,r,o,a,p,l,h,c){var u=e.screenStrips[t];i=Math.sqrt(i),i*=Math.cos(s.rot-r);for(var d,y=Math.round(n/i),f=y*e.stripWidth,g=Math.round((e.screenHeight-y)/2),v=0,m=p.mapTextures,M=App.Properties.texturesPath,b=m.length,S=0;b>S;S++){var x=m[S];if(x.id===o&&x.texture){M+=x.texture;break}}u.src=M,u.oldStyles.src=M,d=y,u.oldStyles.height!==d&&(u.style.height=d+"px",u.oldStyles.height=d);var A=Math.round(a*f);A>f-e.stripWidth&&(A=f-e.stripWidth),A+=l?f:0;var w=Math.floor(2*f);u.oldStyles.width!==w&&(u.style.width=w+"px",u.oldStyles.width=w);var P=g-v;u.oldStyles.top!==P&&(u.style.top=P+"px",u.oldStyles.top=P);var k=t*e.stripWidth-A;u.oldStyles.left!==k&&(u.style.left=k+"px",u.oldStyles.left=k);var C="rect("+v+"px, "+(A+e.stripWidth)+"px, "+(v+y)+"px, "+A+"px)";u.oldStyles.clip!==C&&(u.style.clip=C,u.oldStyles.clip=C);var I=h-s.x,E=c-s.y,T=I*I+E*E;u.style.zIndex=-Math.floor(1e3*T)}var n=60*Math.PI/180,r=2*Math.PI;return e=function(e,t,i){this.player=e,this.miniMap=t,this.screen=i,this.numRays=Math.ceil(this.screen.screenWidth/this.screen.stripWidth),this.viewDist=this.screen.screenWidth/2/Math.tan(n/2)},e.prototype.castRays=function(){for(var e=0,i=0;i<this.numRays;i++){var s=(-this.numRays/2+i)*this.screen.stripWidth,n=Math.sqrt(s*s+this.viewDist*this.viewDist),r=Math.asin(s/n);t(this.screen,this.player,this.miniMap,this.viewDist,r,e++)}},e}),App.define("Screen","engine",function(e){"use strict";return e=function(e){console.log("[Screen] Creating the screen"),this.$selector=e,this.screenWidth=App.Properties.screenWidth,this.screenHeight=App.Properties.screenHeight,this.screenStrips=[],this.stripWidth=App.Properties.stripWidth},e.prototype.init=function(){for(var e=this.$selector.byId("screen"),t=0;t<this.screenWidth;t+=this.stripWidth){var i=this.$selector.createTag("img");i.style.position="absolute",i.style.left="0px",i.style.height="0px",i.oldStyles={left:0,top:0,width:0,height:0,clip:"",src:""},this.screenStrips.push(i),e.appendChild(i)}},e.prototype.addSprites=function(e){this.sprites=e},e.prototype.addEnemies=function(e){this.enemies=e},e}),App.define("Shoot","engine",function(e){"use strict";function t(){return{left:0,top:0,width:0,height:0,clip:"",display:"none",zIndex:0}}var i=App.Properties.spritesPath+"shoot/";return e=function(e,s){this.id=e.id,this.cssRoot="shoot",this.x=e.positionX,this.y=e.positionY,this.type=e.gunType,this.state=0,this.rot=0,this.rotDeg=e.rotDeg,this.dir=0,this.speed=e.speed,this.moveSpeed=e.moveSpeed,this.rotSpeed=3,this.totalStates=3,this.walkCycleTime=250,this.numWalkSprites=2;var n=s.createTag("img");return n.id=this.id,n.src=i+"shoot_"+this.type+".png",n.style.display="none",n.style.position="absolute",n.classList.add(this.cssRoot),this.oldStyles=t(),this.img=n,this}}),App.define("Sound","engine",function(e){"use strict";var t="sounds";return e=function(e){return this.$=e,this},e.prototype.init=function(e,i,s,n){this.audio=this.$.createTag("audio"),this.audio.setAttribute("id",e),this.audio.autoplay=s,this.audio.loop=n;var r=this.$.createTag("source");r.setAttribute("src",i+".wav"),r.setAttribute("type","audio/wav"),this.audio.appendChild(r);var o=this.$.byId(t);o.appendChild(this.audio)},e.prototype.play=function(){this.audio.play()},e.prototype.pause=function(){this.audio.pause()},e.prototype.reset=function(){this.audio.currentTime=0},e}),App.define("Sprites","engine",function(e){"use strict";return e=function(e){console.log("[Sprite] Adding sprites in the game"),this.$selector=e,this.spriteMap=[],this.visibleSprites=[],this.oldVisibleSprites=[]},e.prototype.init=function(e,t){for(var i=e.length,s=0;i>s;s++)this.spriteMap[s]=[];for(var n=this.$selector.byId("screen"),r=t.length,o=0;r>o;o++){var a=t[o],p=this.$selector.createTag("img");p.src=App.Properties.spritesPath+a.img,p.style.display="none",p.style.position="absolute",a.visible=!1,a.block=a.block,a.img=p,this.spriteMap[a.positionY][a.positionX]=a,n.appendChild(p)}},e.prototype.clearObjects=function(){this.oldVisibleSprites=[];for(var e=0;e<this.visibleSprites.length;e++){var t=this.visibleSprites[e];this.oldVisibleSprites[e]=t,t.visible=!1}this.visibleSprites=[]},e.prototype.renderObjects=function(e,t,i,s){for(var n="",r=0;r<this.visibleSprites.length;r++){n=this.visibleSprites[r];var o=n.img;o.style.display="block";var a=n.positionX+.5-e.x,p=n.positionY+.5-e.y,l=Math.sqrt(a*a+p*p),h=Math.atan2(p,a)-e.rot,c=t/(Math.cos(h)*l);if(!(0>=c)){var u=Math.tan(h)*t;o.style.left=i/2+u-c/2+"px",o.style.top=(s-c)/2+"px";var d=n.positionX-e.x,y=n.positionY-e.y;o.style.width=c+"px",o.style.height=c+"px";var f=d*d+y*y;o.style.zIndex=-Math.floor(1e3*f)}}for(r=0;r<this.oldVisibleSprites.length;r++)n=this.oldVisibleSprites[r],this.visibleSprites.indexOf(n)<0&&(n.visible=!1,n.img.style.display="none")},e}),App.define("StatusBar","engine",function(e){"use strict";function t(e){var t=e.createTag("img");return t.src=s+i,t.id="status-bar",t}var i="statusbar.jpg",s=App.Properties.statusbarPath;return e=function(e){console.log("[StatusBar] Creating the status bar"),this.$selector=e,this.weapon=new App.engine.Weapon(e),this.reactions=new App.engine.FaceReaction(e),this.init()},e.prototype.init=function(){var e=this.$selector.byId("screen"),i=t(this.$selector);e.appendChild(this.weapon["default"]()),e.appendChild(i),e.appendChild(this.reactions.faces())},e.prototype.update=function(){},e}),App.define("Weapon","engine",function(e){"use strict";var t;return e=function(e){console.log("[Weapon] Creating the weapon"),t=App.engine.weapons.Pistol,this.$=e,this.listeningShootEvent()},e.prototype.current=function(){return this.current},e.prototype["default"]=function(){var e=new t(this.$);return e.init(),this.current=e,e.img},e.prototype.listeningShootEvent=function(){var e=this;document.addEventListener("shoot",function(t){e.current.shoot()},!1)},e}),App.define("Guard","engine/enemies",function(e){"use strict";function t(){return{left:0,top:0,width:0,height:0,clip:"",display:"none",zIndex:0}}var i="guard-walk.png",s=App.Properties.spritesPath+"guard/";return e=function(e,n){console.log("[Guard] Add guard"),this.cssRoot="guard",this.x=e.positionX,this.y=e.positionY,this.state=0,this.rot=0,this.rotDeg=0,this.dir=0,this.speed=0,this.moveSpeed=.05,this.rotSpeed=3,this.totalStates=5,this.walkCycleTime=1e3,this.numWalkSprites=4;var r=n.createTag("img");return r.src=s+i,r.style.display="none",r.style.position="absolute",r.classList.add(this.cssRoot),this.oldStyles=t(),this.img=r,this}}),App.define("Pistol","engine/weapons",function(e){"use strict";function t(e){for(var t=e.length,i=0;t>i;i++){var s=new Image;s.src=n+e[i]}}function i(e,t,i,s){setTimeout(function(){t.src=n+i,2==a&&(e.soundPistolShooting.reset(),e.soundPistolShooting.play()),a>0&&a--},s)}function s(e){var t=e.$.createTag("img");t.src=n+"pistol_0.png",t.id="weapon",t.className="pistol",e.img=t}var n=App.Properties.statusbarPath+"pistol/",r=App.Properties.soundPath+"weapons/",o=50,a=0;return e=function(e){this.$=e},e.prototype.init=function(){this.soundPistolShooting=new App.engine.Sound(this.$),this.soundPistolShooting.init("pistol",r+"pistol",!1,!1),this.frames=["pistol_0.png","pistol_4.png","pistol_1.png","pistol_2.png","pistol_3.png","pistol_1.png","pistol_4.png","pistol_0.png"],t(this.frames),s(this)},e.prototype.shoot=function(){if(0===a){var e=this,t=e.frames.length;a=t;for(var s=0;t>s;s++)i(e,e.img,e.frames[s],o*s)}},e}),App.maps.firstLevel={playerX:10.5,playerY:6.5,map:[[1,1,1,1,1,1,1,1,5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,3,0,3,0,0,1,1,1,2,1,1,1,1,1,2,1,1,1,2,1,0,0,0,0,0,0,0,0,1],[1,0,0,3,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,1,1,1],[1,0,0,3,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,3,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[1,0,0,3,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[1,0,0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,0,0,0,0,0,0,0,3,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,4,0,0,4,2,0,2,2,2,2,2,2,2,2,0,2,4,4,0,0,4,0,0,0,0,0,0,0,1],[1,0,0,4,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,4,0,0,0,0,0,0,0,1],[1,0,0,4,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,4,0,0,0,0,0,0,0,1],[1,0,0,4,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,4,0,0,0,0,0,0,0,1],[1,0,0,4,3,3,4,2,2,2,2,2,2,2,2,2,2,2,2,2,4,3,3,4,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],mapTextures:[{id:1,texture:"walls_1.png"},{id:2,texture:"walls_2.png"},{id:3,texture:"walls_3.png"},{id:4,texture:"walls_4.png"},{id:5,texture:"walls_5.png"}],objects:[{img:"lamp.png",positionX:10,positionY:7,block:!1},{img:"lamp.png",positionX:15,positionY:7,block:!1},{img:"tablechairs.png",positionX:10,positionY:18,block:!0},{img:"tablechairs.png",positionX:15,positionY:18,block:!0},{img:"plantgreen.png",positionX:10,positionY:11,block:!0},{img:"plantgreen.png",positionX:15,positionY:11,block:!0}],enemies:[{type:"guard",positionX:20,positionY:9},{type:"guard",positionX:18,positionY:6}],backgroundSound:{id:"sound-level-01",track:"level_01",type:"wav"}},App.define("Stage","views/stage",function(e,t,i){"use strict";function s(e){e.innerHTML+=i.screen(),e.innerHTML+=i.mini_map(),e.innerHTML+=i.fps_debug()}function n(){var e=App.maps.firstLevel,i=new r(e,t);i.init();var s=new o(t);s.init();var n=new h(t);n.init(e.map,e.objects);var g=new c(t);g.init(e.enemies),s.addSprites(n),s.addEnemies(g);var v=new a,m=new p(e.playerX,e.playerY),M=new l(m,i,s),b=new u(t),S=e.backgroundSound,x=new d(t);x.init(S.id,f+S.track,!0,!0);var A=new y(t);document.gameEvents=A,v.setElements(m,i,s,M,b,x,A),v.init(),v.renderCycle()}var r=App.engine.MiniMap,o=App.engine.Screen,a=App.engine.GameCycle,p=App.engine.Player,l=App.engine.Raycasting,h=App.engine.Sprites,c=App.engine.Enemies,u=App.engine.StatusBar,d=App.engine.Sound,y=App.engine.GameEvents,f=App.Properties.soundPath+"levels/";return e.prototype.init=function(){var e;App.Helpful.isNodeWebkit()||(e=t.getByTag("body"),e.className="in-browser");var i=t.byId(App.container);s(i),n()},e}),document.addEventListener("DOMContentLoaded",function(e){var t=new App.views.stage.Stage;t.init()});